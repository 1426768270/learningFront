<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Type Ahead ğŸ‘€</title>
    <link rel="stylesheet" href="style.css"/>
</head>

<body>
    <form class="search-form">
        <input type="text" class="search" placeholder="City or State">
        <ul class="suggestions">
            <li>
                Filter for a city
            </li>
            <li>
                or a state
            </li>
        </ul>
    </form>
</body>
<script>
    const endpoint = "https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json"
    //1.è·å–æ•°æ®è·å¾—primiseè½¬æ¢æˆjson
    const cities = []
    fetch(endpoint)
    .then(response => response.json())      //è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡
    .then(data => cities.push(...data));    //å±•å¼€æ•´ä¸ªæ•°ç»„æ”¾åˆ°é‡Œé¢

    //2.å­—ç¬¦ä¸²åŒ¹é…çš„æ–¹æ³•
    function findMatch(wordsToMatch, cities) { 
        return cities.filter(place => {         //è¿”å›ç»“æœ
            const regex = new RegExp(wordsToMatch,"gi");     //åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œgï¼šæ‰€æœ‰ï¼Œiï¼šä¸åŒºåˆ†å¤§å°å†™
            //åŒ¹é…
            return place.city.match(regex) || place.state.match(regex) //æ­£åˆ™è¡¨è¾¾å¼å…¨å±€åŒ¹é…   
        });
    }
    //ï¼Œåˆ†å‰²
    function numberWiteComas(x) {
        return x.toString().replace(/B(?=(\d{3})+(?!\d))/g,',');
    }

    //3. å±•ç¤ºæ•°æ®
    function displayMatchs() {
        const matchArray = findMatch(this.value, cities);
        //è·å–htmlå…ƒç´ 
        //mapä¹‹åè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œéœ€è¦è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²
        const html = matchArray.map(place => {
            //é«˜äº®æ˜¾ç¤º
            const regex = new RegExp(this.value,"gi");  
            const cityName = place.city.replace(regex,`<span class="hl">${this.value}</span>`);
            const stateName = place.state.replace(regex,`<span class="hl">${this.value}</span>`);
            return `
                <li>
                    <span class="name">${cityName},${stateName}</span>
                    <span class="population">${numberWiteComas(place.population)}</span>
                </li>
            `;
        }).join('');//æŠŠï¼Œè½¬æ¢æˆç©ºå­—ç¬¦ä¸²
        
        const suggestions = document.querySelector('.suggestions');
        suggestions.innerHTML = html;   //æ›¿æ¢å­å…ƒç´ 
    }

    //æ¯æ¬¡è¾“å…¥æ¡†æ”¹å˜å°±è°ƒç”¨å±•ç¤ºæ•°æ®
    const searchInput = document.querySelector('.search');
    searchInput.addEventListener('change',displayMatchs);
    searchInput.addEventListener('keyup',displayMatchs);       //é”®ç§»å‡ºçš„æ—¶å€™


   

</script>

</html>